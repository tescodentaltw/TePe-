<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅行組訂購</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: url('https://i.meee.com.tw/UCK30VJ.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: #005ea4;
        }
        .container {
            max-width: 960px;
        }
        .scroll-container {
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        .product-card {
            min-width: 180px;
        }
        .product-image {
            transition: transform 0.3s ease-in-out;
        }
        .product-image:hover {
            transform: scale(1.05);
        }
        .quantity-input {
            appearance: textfield;
            -moz-appearance: textfield;
            -webkit-appearance: textfield;
            border-color: #8aced6;
        }
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .arrow-button {
            background-color: rgba(0, 94, 164, 0.5);
            color: white;
            border-radius: 9999px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }
        .arrow-button:hover {
            background-color: rgba(0, 94, 164, 0.8);
        }
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 25px;
            color: #fff;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .close-button:hover,
        .close-button:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }
        .gift-checkbox {
            transform: scale(1.5);
            accent-color: #005ea4;
        }
        .discount-table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1rem;
        }
        .discount-table th, .discount-table td {
            border: 1px solid #005ea4;
            padding: 8px;
            text-align: center;
        }
        .gift-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        h1 {
            font-size: 2.25rem; /* text-4xl equivalent */
            line-height: 2.5rem;
            font-weight: 800; /* font-extrabold equivalent */
        }
        h2 {
            font-size: 1.75rem; /* text-2xl equivalent */
            line-height: 2.25rem;
            font-weight: 700; /* font-bold equivalent */
        }
        .section-text {
            font-size: 1rem; /* text-base equivalent */
            line-height: 1.5rem;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container mx-auto">
        <div class="flex justify-center mb-8">
            <img src="https://i.meee.com.tw/4Ojn0aJ.png" alt="TePe Logo" class="h-16 sm:h-20" onerror="this.onerror=null;this.src='https://placehold.co/100x100?text=TePe'">
        </div>
    </div>
    
    <!-- 總計金額與標題 (合併) -->
    <div class="container mx-auto bg-[#8aced6] rounded-3xl shadow-xl p-6 sm:p-10 my-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-[#005ea4] mb-4">旅行組訂購</h1>
        <p class="section-text text-center text-[#005ea4] mb-8">
            請選擇您所需的數量與品項，系統將會自動為您計算總價。此價格已包含旅行組外盒、獨家診所名稱貼紙(會為您設計)。有購買滿100/200/300組都會有不同的贈品可供挑選。
        </p>
        <div class="flex justify-center cursor-pointer transform transition-transform duration-300 hover:scale-105" onclick="openImageModal('https://i.meee.com.tw/7hSonwC.png')">
            <img src="https://i.meee.com.tw/7hSonwC.png" alt="Travel Kit" class="w-full rounded-xl shadow-md" style="max-width: 100%;">
        </div>
    </div>

    <!-- 訂購區塊 -->
    <div class="container mx-auto bg-white rounded-3xl shadow-xl p-6 sm:p-10 my-8">

        <!-- 第一步：選擇主要牙刷與數量 -->
        <div class="bg-[#8aced6] border border-[#8aced6] rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-[#005ea4] mb-2">第一步：選擇主要牙刷</h2>
            <p class="section-text text-sm text-[#005ea4] mb-1">
                最低總訂購量為100，可以隨意搭配不同牙刷，總訂購量請盡量以100的倍數為主，謝謝！
            </p>
            <p id="main-toothbrush-warning" class="section-text text-sm text-[#e50031] mb-2 hidden">
                訂購總量未達100，請輸入數量至訂購總量高於100。
            </p>
            <table class="discount-table text-sm mb-4">
                <thead>
                    <tr>
                        <th class="rounded-tl-lg text-white bg-[#005ea4]">訂購總量</th>
                        <th class="rounded-tr-lg text-white bg-[#005ea4]">折扣</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="bg-[#8aced6] text-[#005ea4]">100</td>
                        <td class="bg-[#8aced6] text-[#005ea4]">68折</td>
                    </tr>
                    <tr>
                        <td class="bg-[#8aced6] text-[#005ea4]">200</td>
                        <td class="bg-[#8aced6] text-[#005ea4]">63折</td>
                    </tr>
                    <tr>
                        <td class="rounded-bl-lg bg-[#8aced6] text-[#005ea4]">300或以上</td>
                        <td class="rounded-br-lg bg-[#8aced6] text-[#005ea4]">6折</td>
                    </tr>
                </tbody>
            </table>
            <div class="relative flex items-center">
                <button class="arrow-button absolute left-0 z-10" onclick="scrollContainer('main-toothbrushes-container', -200)">
                    &#8249;
                </button>
                <div id="main-toothbrushes-container" class="scroll-container flex space-x-6 pb-4 w-full">
                </div>
                <button class="arrow-button absolute right-0 z-10" onclick="scrollContainer('main-toothbrushes-container', 200)">
                    &#8250;
                </button>
            </div>
        </div>

        <!-- 第二步：選擇免費贈品 -->
        <div class="bg-[#8aced6] border border-[#8aced6] rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-[#005ea4] mb-2">第二步：選擇免費贈品</h2>
            <p id="gift-message" class="section-text text-sm text-[#005ea4] mb-4">
                您目前能勾選 <span id="gift-limit" class="font-semibold text-[#e50031]">0</span> 個贈品，
                <br>再加入 <span id="gift-next-tier-diff" class="font-semibold text-[#e50031]">0</span> 個牙刷旅行組將能再多勾選一個贈品。
            </p>
            <p id="gift-congratulation" class="section-text text-sm text-[#005ea4] mb-4 hidden">
                恭喜您已能勾選3樣贈品！
            </p>
            <div class="relative flex items-center">
                <button class="arrow-button absolute left-0 z-10" onclick="scrollContainer('free-gifts-container', -200)">
                    &#8249;
                </button>
                <div id="free-gifts-container" class="scroll-container flex space-x-6 pb-4 w-full">
                </div>
                <button class="arrow-button absolute right-0 z-10" onclick="scrollContainer('free-gifts-container', 200)">
                    &#8250;
                </button>
            </div>
        </div>

        <!-- 第三步：選擇加購品項 -->
        <div class="bg-[#8aced6] border border-[#8aced6] rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-[#005ea4] mb-4">第三步：選擇加購品項</h2>
            <p class="section-text text-sm text-[#005ea4] mb-4">
                這些品項或許需額外付費，詳情請與您的業務洽詢。
            </p>
            <div class="relative flex items-center">
                <button class="arrow-button absolute left-0 z-10" onclick="scrollContainer('addon-items-container', -200)">
                    &#8249;
                </button>
                <div id="addon-items-container" class="scroll-container flex space-x-6 pb-4 w-full">
                </div>
                <button class="arrow-button absolute right-0 z-10" onclick="scrollContainer('addon-items-container', 200)">
                    &#8250;
                </button>
            </div>
        </div>
        
        <!-- 聯繫資訊 -->
        <div class="bg-[#8aced6] border border-[#8aced6] rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-[#005ea4] mb-4">聯繫資訊</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-[#005ea4]">
                <div>
                    <label for="name" class="block text-sm font-medium mb-1">姓名</label>
                    <div class="flex items-center">
                        <input type="text" id="name" class="w-full p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800">
                        <select id="gender" class="ml-2 p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800 bg-white">
                            <option value="小姐">小姐</option>
                            <option value="先生">先生</option>
                            <option value="不公開">不公開</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="clinic-name" class="block text-sm font-medium mb-1">診所名稱</label>
                    <input type="text" id="clinic-name" class="w-full p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium mb-1">聯絡電話</label>
                    <input type="tel" id="phone" class="w-full p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800">
                </div>
                <div>
                    <label for="sales-rep-name" class="block text-sm font-medium mb-1">業務名稱</label>
                    <input type="text" id="sales-rep-name" class="w-full p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800">
                </div>
                <div>
                    <label for="city" class="block text-sm font-medium mb-1">診所地址</label>
                    <div class="flex space-x-2">
                        <select id="city" class="w-1/2 p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800 bg-white">
                            <option value="">請選擇縣市</option>
                        </select>
                        <select id="district" class="w-1/2 p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800 bg-white">
                            <option value="">請選擇區</option>
                        </select>
                    </div>
                    <input type="text" id="address-detail" placeholder="詳細地址" class="w-full mt-2 p-2 rounded-md border border-[#8aced6] focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800">
                </div>
            </div>
        </div>

        <!-- 訂單總計區塊 -->
        <div class="bg-[#005ea4] border border-[#005ea4] rounded-2xl p-6 mb-8 text-white">
            <h2 class="text-2xl font-bold text-white text-center mb-4">訂單總計</h2>
            <div class="space-y-2">
                <div class="flex justify-between border-b border-white pb-2">
                    <span class="font-medium">旅行組總價：</span>
                    <span id="main-total" class="font-bold">$0</span>
                </div>
                <div class="flex justify-between border-b border-white pb-2" id="discounted-price-row">
                    <span id="discounted-total-label" class="font-medium">旅行組折後總價：</span>
                    <span id="discounted-total" class="font-bold">$0</span>
                </div>
                <div class="flex justify-between border-b border-white pb-2">
                    <span class="font-medium text-[#ea5293]">共省下：</span>
                    <span id="total-savings" class="font-bold text-[#ea5293]">$0</span>
                </div>
                <div class="flex justify-between text-2xl font-bold pt-2">
                    <span>訂單總金額：</span>
                    <span id="grand-total">$0</span>
                </div>
            </div>
        </div>

        <!-- 按鈕區塊 -->
        <div class="flex justify-center space-x-4">
            <button id="reset-btn" class="bg-[#8aced6] hover:bg-[#72b8c9] text-[#005ea4] font-bold py-2 px-6 rounded-full transition-colors">
                重置
            </button>
            <button id="submit-btn" class="bg-[#005ea4] hover:bg-[#004e93] text-white font-bold py-2 px-6 rounded-full transition-colors">
                提交
            </button>
        </div>
    </div>
    
    <!-- 版權資訊 -->
    <div class="container mx-auto text-center text-gray-700 text-xs mt-8">
        TePe 緹碧瑞典專業口腔護理品牌 Copyright © 2022 TESCO DENTAL TW All RIGHTS RESERVED
    </div>

    <!-- 彈窗訊息 -->
    <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl text-center max-w-sm mx-4">
            <p id="message-text" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="close-message" class="bg-[#005ea4] hover:bg-[#004e93] text-white font-bold py-2 px-4 rounded-full transition-colors">
                好的
            </button>
        </div>
    </div>

    <!-- 訂單內容彈窗 -->
    <div id="order-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-lg mx-4">
            <h3 class="text-xl font-bold text-center mb-4">訂單內容</h3>
            <p class="text-sm text-gray-600 text-center mb-4">請複製以下內容並貼至電子郵件中發送。</p>
            <div id="order-details-display" class="bg-gray-100 p-4 rounded-lg overflow-auto max-h-96 text-sm text-gray-800 mb-4 whitespace-pre-wrap font-mono"></div>
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 justify-center">
                <button id="copy-btn" class="bg-[#8aced6] hover:bg-[#72b8c9] text-[#005ea4] font-bold py-2 px-6 rounded-full transition-colors">
                    複製內容
                </button>
                <button id="send-mail-btn" class="bg-[#005ea4] hover:bg-[#004e93] text-white font-bold py-2 px-6 rounded-full transition-colors">
                    發送 (僅適用於電腦版)
                </button>
            </div>
            <button id="close-order-modal" class="hidden sm:inline-block mt-4 w-full bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full transition-colors">
                關閉
            </button>
        </div>
    </div>
    
    <!-- 圖片預覽彈窗 -->
    <div id="image-modal" class="modal hidden">
        <span class="close-button" onclick="closeImageModal()">&times;</span>
        <div class="modal-content">
            <img id="modal-image" class="modal-image">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const taiwanDistricts = {
                "台北市": ["中正區", "大同區", "中山區", "松山區", "大安區", "萬華區", "信義區", "士林區", "北投區", "內湖區", "南港區", "文山區"],
                "新北市": ["板橋區", "新莊區", "中和區", "永和區", "土城區", "蘆洲區", "樹林區", "汐止區", "三重區", "淡水區", "新店區", "鶯歌區", "三峽區", "泰山區", "林口區", "五股區", "八里區", "深坑區", "石碇區", "坪林區", "三芝區", "石門區", "金山區", "萬里區", "瑞芳區", "貢寮區", "雙溪區", "平溪區", "烏來區"],
                "桃園市": ["中壢區", "桃園區", "八德區", "楊梅區", "平鎮區", "大溪區", "龍潭區", "蘆竹區", "龜山區", "大園區", "觀音區", "新屋區", "復興區"],
                "台中市": ["西屯區", "北屯區", "南屯區", "北區", "西區", "東區", "中區", "南區", "大里區", "太平區", "豐原區", "潭子區", "大雅區", "沙鹿區", "清水區", "龍井區", "梧棲區", "后里區", "神岡區", "霧峰區", "烏日區", "大甲區", "外埔區", "大安區", "東勢區", "石岡區", "新社區", "和平區"],
                "台南市": ["安南區", "永康區", "東區", "北區", "中西區", "南區", "安平區", "新營區", "仁德區", "歸仁區", "佳里區", "善化區", "麻豆區", "新化區", "新市區", "關廟區", "安定區", "西港區", "七股區", "將軍區", "學甲區", "鹽水區", "官田區", "下營區", "六甲區", "柳營區", "後壁區", "東山區", "白河區", "楠西區", "南化區", "玉井區", "左鎮區", "山上區", "大內區", "龍崎區"],
                "高雄市": ["鳳山區", "左營區", "前鎮區", "三民區", "楠梓區", "小港區", "鼓山區", "苓雅區", "新興區", "前金區", "鹽埕區", "旗津區", "岡山區", "路竹區", "旗山區", "美濃區", "梓官區", "橋頭區", "燕巢區", "田寮區", "阿蓮區", "湖內區", "茄萣區", "永安區", "彌陀區", "內門區", "杉林區", "甲仙區", "六龜區", "茂林區", "桃源區", "那瑪夏區", "大寮區", "林園區", "仁武區", "大樹區", "鳥松區"],
                "基隆市": ["仁愛區", "信義區", "中正區", "中山區", "安樂區", "暖暖區", "七堵區"],
                "新竹市": ["東區", "北區", "香山區"],
                "嘉義市": ["東區", "西區"],
                "新竹縣": ["竹北市", "竹東鎮", "新埔鎮", "關西鎮", "湖口鄉", "新豐鄉", "芎林鄉", "橫山鄉", "北埔鄉", "寶山鄉", "峨眉鄉", "尖石鄉", "五峰鄉"],
                "苗栗縣": ["苗栗市", "竹南鎮", "頭份市", "後龍鎮", "通霄鎮", "苑裡鎮", "卓蘭鎮", "造橋鄉", "公館鄉", "大湖鄉", "銅鑼鄉", "南庄鄉", "頭屋鄉", "三義鄉", "西湖鄉", "獅潭鄉", "三灣鄉", "泰安鄉"],
                "彰化縣": ["彰化市", "員林市", "和美鎮", "鹿港鎮", "溪湖鎮", "田中鎮", "北斗鎮", "花壇鄉", "芬園鄉", "大村鄉", "埔心鄉", "埔鹽鄉", "永靖鄉", "社頭鄉", "二水鄉", "田尾鄉", "埤頭鄉", "芳苑鄉", "大城鄉", "竹塘鄉", "二林鎮", "伸港鄉", "線西鄉", "福興鄉", "秀水鄉"],
                "南投縣": ["南投市", "埔里鎮", "草屯鎮", "竹山鎮", "集集鎮", "名間鄉", "鹿谷鄉", "中寮鄉", "魚池鄉", "國姓鄉", "水里鄉", "信義鄉", "仁愛鄉"],
                "雲林縣": ["斗六市", "斗南鎮", "虎尾鎮", "西螺鎮", "土庫鎮", "北港鎮", "莿桐鄉", "林內鄉", "古坑鄉", "大埤鄉", "崙背鄉", "二崙鄉", "麥寮鄉", "東勢鄉", "褒忠鄉", "臺西鄉", "元長鄉", "口湖鄉", "水林鄉", "四湖鄉"],
                "嘉義縣": ["太保市", "朴子市", "布袋鎮", "大林鎮", "民雄鄉", "溪口鄉", "新港鄉", "六腳鄉", "東石鄉", "義竹鄉", "鹿草鄉", "中埔鄉", "竹崎鄉", "梅山鄉", "番路鄉", "大埔鄉", "阿里山鄉"],
                "屏東縣": ["屏東市", "潮州鎮", "東港鎮", "恆春鎮", "萬丹鄉", "長治鄉", "麟洛鄉", "九如鄉", "里港鄉", "鹽埔鄉", "高樹鄉", "萬巒鄉", "內埔鄉", "竹田鄉", "新埤鄉", "枋寮鄉", "新園鄉", "崁頂鄉", "林邊鄉", "南州鄉", "佳冬鄉", "枋山鄉", "車城鄉", "滿州鄉", "霧台鄉", "瑪家鄉", "泰武鄉", "來義鄉", "春日鄉", "獅子鄉", "牡丹鄉", "三地門鄉"],
                "宜蘭縣": ["宜蘭市", "羅東鎮", "蘇澳鎮", "頭城鎮", "礁溪鄉", "壯圍鄉", "員山鄉", "冬山鄉", "五結鄉", "三星鄉", "大同鄉", "南澳鄉"],
                "花蓮縣": ["花蓮市", "鳳林鎮", "玉里鎮", "新城鄉", "吉安鄉", "壽豐鄉", "光復鄉", "豐濱鄉", "瑞穗鄉", "秀林鄉", "萬榮鄉", "卓溪鄉"],
                "台東縣": ["臺東市", "成功鎮", "關山鎮", "卑南鄉", "大武鄉", "太麻里鄉", "東河鄉", "長濱鄉", "鹿野鄉", "池上鄉", "綠島鄉", "蘭嶼鄉", "海端鄉", "延平鄉", "金峰鄉", "達仁鄉"],
                "澎湖縣": ["馬公市", "湖西鄉", "白沙鄉", "西嶼鄉", "望安鄉", "七美鄉"],
                "金門縣": ["金城鎮", "金湖鎮", "金沙鎮", "金寧鄉", "烈嶼鄉", "烏坵鄉"],
                "連江縣": ["南竿鄉", "北竿鄉", "莒光鄉", "東引鄉"],
            };

            const mainToothbrushes = [
                { name: '至尊雙層刷毛牙刷', image: 'https://i.meee.com.tw/rqJQK61.png', price: 140, quantity: 0 },
                { name: '迷你至尊雙層刷毛牙刷', image: 'https://i.meee.com.tw/w3hlkno.png', price: 140, quantity: 0 },
                { name: '深層潔淨牙刷(超軟毛)', image: 'https://i.meee.com.tw/Vw7j5ux.png', price: 120, quantity: 0 },
                { name: '精選全效牙刷(纖細刷頭/超軟毛)', image: 'https://i.meee.com.tw/fLEMin1.png', price: 100, quantity: 0 },
                { name: '防敏感型牙刷', image: 'https://i.meee.com.tw/p2wv6mB.png', price: 125, quantity: 0 },
                { name: '迷你幼兒牙刷(0-3歲適用)', image: 'https://i.meee.com.tw/0foVbiT.png', price: 130, quantity: 0 },
                { name: '兒童牙刷(3歲以上適用)', image: 'https://i.meee.com.tw/Ci7PKAz.png', price: 130, quantity: 0 },
                { name: '單頭刷', image: 'https://i.meee.com.tw/d3ssRLm.png', price: 140, quantity: 0 },
                { name: '加護型牙刷(紅色大刷頭)', image: 'https://i.meee.com.tw/OL5T2dF.png', price: 175, quantity: 0 },
                { name: '加護型牙刷(藍色小刷頭)', image: 'https://i.meee.com.tw/dLEy6Et.png', price: 175, quantity: 0 },
            ];

            const allFreeGifts = [
                { name: '輕鬆剔XS/S(2入裝)', image: 'https://i.meee.com.tw/avxcDOM.jpg', checked: false },
                { name: '輕鬆剔M/L(2入裝)', image: 'https://i.meee.com.tw/WGMzm4x.jpg', checked: false },
                { name: '牙刷保護蓋(顏色隨機)', image: 'https://i.meee.com.tw/ExGL4PC.png', checked: false },
                { name: 'L型牙間刷0.4mm(單支裝)', image: 'https://i.meee.com.tw/7uQPW6E.png', checked: false },
                { name: 'L型牙間刷0.45mm(單支裝)', image: 'https://i.meee.com.tw/8BrJ0F0.png', checked: false },
                { name: 'L型牙間刷0.5mm(單支裝)', image: 'https://i.meee.com.tw/D5Z7r5A.png', checked: false },
                { name: 'L型牙間刷0.6mm(單支裝)', image: 'https://i.meee.com.tw/mF9s0gm.png', checked: false },
                { name: 'L型牙間刷0.7mm(單支裝)', image: 'https://i.meee.com.tw/2SfRVby.png', checked: false },
                { name: 'L型牙間刷0.8mm(單支裝)', image: 'https://i.meee.com.tw/sgIHFyz.png', checked: false },
                { name: 'I型牙間刷(僅限0號0.4mm粉紅色)(單支裝)', image: 'https://i.meee.com.tw/iFvapl0.png', checked: false },
                { name: '小膨脹牙線', image: 'https://i.meee.com.tw/IMiWQwF.jpg', checked: false },
            ];

            const addonItems = [
                { name: 'Tesco 牙齒娃娃', image: 'https://i.meee.com.tw/k9MjJaF.png', price: 80 },
                { name: 'TePe 2分鐘沙漏 (輔助計時刷牙時間)', image: 'https://i.meee.com.tw/a64LB7e.png', price: 70 },
                { name: 'TePe 陶瓷牙刷座(白色)', image: 'https://i.meee.com.tw/kQX4f2y.png', price: 60 },
                { name: 'TePe 牙間刷旅用攜帶盒', image: 'https://i.meee.com.tw/pIySKjJ.png', price: 85 },
                { name: 'TePe 牙間刷居家收納盒', image: 'https://i.meee.com.tw/sGoKFdn.png', price: 85 },
            ];

            const mainTotalEl = document.getElementById('main-total');
            const grandTotalEl = document.getElementById('grand-total');
            const mainToothbrushWarningEl = document.getElementById('main-toothbrush-warning');
            const giftLimitEl = document.getElementById('gift-limit');
            const giftNextTierDiffEl = document.getElementById('gift-next-tier-diff');
            const giftMessageEl = document.getElementById('gift-message');
            const giftCongratulationEl = document.getElementById('gift-congratulation');
            const discountedTotalEl = document.getElementById('discounted-total');
            const totalSavingsEl = document.getElementById('total-savings');
            const discountedPriceRow = document.getElementById('discounted-price-row');

            const imageModal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const orderModal = document.getElementById('order-modal');
            const orderDetailsDisplay = document.getElementById('order-details-display');
            const copyBtn = document.getElementById('copy-btn');
            const sendMailBtn = document.getElementById('send-mail-btn');
            const closeOrderModalBtn = document.getElementById('close-order-modal');

            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            const closeMessageBtn = document.getElementById('close-message');
            const resetButton = document.getElementById('reset-btn');
            const submitButton = document.getElementById('submit-btn');

            window.scrollContainer = function(containerId, scrollAmount) {
                const container = document.getElementById(containerId);
                container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            };

            window.openImageModal = function(src) {
                modalImage.src = src;
                imageModal.classList.remove('hidden');
            };

            window.closeImageModal = function() {
                imageModal.classList.add('hidden');
            };

            function showMessage(text) {
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }

            closeMessageBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });
            
            function updateTotals() {
                const totalMainQuantity = mainToothbrushes.reduce((sum, item) => sum + item.quantity, 0);

                let discountRate = 1;
                let discountedTotal = 0;
                let mainTotalPrice = mainToothbrushes.reduce((sum, item) => sum + item.price * item.quantity, 0);

                if (totalMainQuantity >= 300) {
                    discountRate = 0.60;
                } else if (totalMainQuantity >= 200) {
                    discountRate = 0.63;
                } else if (totalMainQuantity >= 100) {
                    discountRate = 0.68;
                }

                discountedTotal = mainTotalPrice * discountRate;
                const totalSavings = mainTotalPrice - discountedTotal;

                mainTotalEl.textContent = `$${mainTotalPrice}`;
                discountedTotalEl.textContent = `$${Math.round(discountedTotal)}`;
                totalSavingsEl.textContent = `$${Math.round(totalSavings)}`;
                grandTotalEl.textContent = `$${Math.round(discountedTotal)}`;

                if (totalMainQuantity >= 100) {
                    discountedPriceRow.classList.remove('hidden');
                    totalSavingsEl.parentElement.classList.remove('hidden');
                } else {
                    discountedPriceRow.classList.add('hidden');
                    totalSavingsEl.parentElement.classList.add('hidden');
                }
            }

            function renderItems(containerId, items) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                const totalMainQuantity = mainToothbrushes.reduce((sum, item) => sum + item.quantity, 0);
                const discountRate = totalMainQuantity >= 300 ? 0.60 : totalMainQuantity >= 200 ? 0.63 : totalMainQuantity >= 100 ? 0.68 : 1;

                items.forEach((item, index) => {
                    const isMainToothbrush = containerId === 'main-toothbrushes-container';
                    const isFreeGift = containerId === 'free-gifts-container';
                    const isAddon = containerId === 'addon-items-container';

                    const card = document.createElement('div');
                    card.className = `product-card flex-none w-44 rounded-xl overflow-hidden shadow-md bg-[#d3f3f5] transition-all duration-300 transform`;
                    
                    if (isFreeGift) {
                        card.classList.add('gift-card');
                    } else {
                        card.classList.remove('gift-card');
                        card.classList.add('hover:scale-100'); // Reset hover scale for non-gift cards
                        card.classList.add('hover:shadow-md'); // Reset hover shadow for non-gift cards
                    }

                    let priceDisplay = '';
                    if (isMainToothbrush) {
                        const discountedPrice = item.price * discountRate;
                        if (totalMainQuantity >= 100) {
                            const discountText = totalMainQuantity >= 300 ? '6' : totalMainQuantity >= 200 ? '63' : '68';
                            priceDisplay = `
                                <div class="flex flex-col items-center mt-2">
                                    <p class="text-sm text-[#005ea4]">享 ${discountText} 折</p>
                                    <p class="text-sm text-[#005ea4] line-through">定價 $${item.price}</p>
                                    <p class="text-center font-bold text-lg text-[#005ea4] mt-1">優惠價 $${Math.round(discountedPrice)}</p>
                                </div>
                            `;
                        } else {
                            priceDisplay = `<p class="text-center font-bold text-lg text-[#005ea4] mt-2">定價 $${item.price}</p>`;
                        }
                    } else if (isAddon) {
                        priceDisplay = `<p class="text-center font-bold text-lg text-[#005ea4] mt-2">定價 $${item.price}</p>`;
                    }

                    let quantityControl = '';
                    if (isMainToothbrush) {
                        quantityControl = `
                            <div class="mt-4 w-full text-center">
                                <label for="${containerId}-quantity-${index}" class="text-sm text-gray-500 block mb-1">數量</label>
                                <input type="number" id="${containerId}-quantity-${index}" value="${item.quantity}" min="0" class="quantity-input w-full p-2 text-center border rounded-md focus:outline-none focus:ring-2 focus:ring-[#005ea4] text-gray-800" />
                            </div>
                        `;
                    } else if (isFreeGift) {
                        quantityControl = `
                            <div class="mt-4 w-full text-center">
                                <label class="text-sm text-gray-500 block mb-1">選擇</label>
                                <input type="checkbox" id="${containerId}-check-${index}" class="gift-checkbox" ${item.checked ? 'checked' : ''} />
                            </div>
                        `;
                    } else if (isAddon) {
                         quantityControl = `
                            <div class="mt-4 w-full text-center">
                                <p class="text-sm text-gray-500">歡迎與業務洽詢</p>
                            </div>
                        `;
                    }
                    
                    card.innerHTML = `
                        <div class="p-4 flex flex-col items-center">
                            <img src="${item.image}" alt="${item.name}" class="product-image w-28 h-28 object-contain rounded-lg mb-2 border border-gray-200 cursor-pointer" onclick="openImageModal('${item.image}')" onerror="this.onerror=null;this.src='https://placehold.co/100x100/F0F0F0/000000?text=圖片載入失敗';" />
                            <h3 class="font-bold text-center text-[#005ea4] text-base min-h-[40px]">${item.name}</h3>
                            ${priceDisplay}
                            ${quantityControl}
                        </div>
                    `;
                    container.appendChild(card);
                    
                    if (isMainToothbrush) {
                        const input = card.querySelector(`#${containerId}-quantity-${index}`);
                        input.addEventListener('change', (e) => { // Updated to 'change' event
                            item.quantity = parseInt(e.target.value, 10) || 0;
                            updateDisplay();
                        });
                    } else if (isFreeGift) {
                        const checkbox = card.querySelector(`#${containerId}-check-${index}`);
                        card.addEventListener('click', (e) => {
                            if (e.target.tagName !== 'INPUT') { 
                                checkbox.checked = !checkbox.checked;
                            }
                            if (checkbox.checked) {
                                const totalMainQuantity = mainToothbrushes.reduce((sum, item) => sum + item.quantity, 0);
                                const giftLimit = getGiftLimit(totalMainQuantity);
                                const currentSelected = allFreeGifts.filter(g => g.checked).length;
                                
                                if (currentSelected >= giftLimit) {
                                    checkbox.checked = false;
                                    showMessage(`您目前最多只能選擇 ${giftLimit} 份免費贈品。`);
                                } else {
                                    item.checked = true;
                                }
                            } else {
                                item.checked = false;
                            }
                            updateDisplay();
                        });
                        checkbox.addEventListener('change', () => {
                            updateDisplay();
                        });
                    }
                });
            }
            
            function getGiftLimit(totalMainQuantity) {
                if (totalMainQuantity >= 300) {
                    return 3;
                } else if (totalMainQuantity >= 200) {
                    return 2;
                } else if (totalMainQuantity >= 100) {
                    return 1;
                }
                return 0;
            }

            function updateDisplay() {
                const totalMainQuantity = mainToothbrushes.reduce((sum, item) => sum + item.quantity, 0);
                
                const giftLimit = getGiftLimit(totalMainQuantity);
                
                // Update free gift message
                if (totalMainQuantity >= 300) {
                    giftMessageEl.classList.add('hidden');
                    giftCongratulationEl.classList.remove('hidden');
                } else {
                    giftMessageEl.classList.remove('hidden');
                    giftCongratulationEl.classList.add('hidden');
                    const nextTierQty = totalMainQuantity >= 200 ? 300 : totalMainQuantity >= 100 ? 200 : 100;
                    const diff = nextTierQty - totalMainQuantity;
                    giftLimitEl.textContent = giftLimit;
                    giftNextTierDiffEl.textContent = diff;
                }
                
                // Update main toothbrush warning
                if (totalMainQuantity < 100) {
                    mainToothbrushWarningEl.classList.remove('hidden');
                } else {
                    mainToothbrushWarningEl.classList.add('hidden');
                }

                renderItems('main-toothbrushes-container', mainToothbrushes);
                renderItems('addon-items-container', addonItems);
                
                // Filter gifts to show
                let giftsToShow = [];
                if (totalMainQuantity >= 300) {
                    giftsToShow = allFreeGifts;
                } else if (totalMainQuantity >= 200) {
                    giftsToShow = allFreeGifts.slice(0, 10);
                } else if (totalMainQuantity >= 100) {
                    giftsToShow = allFreeGifts.slice(0, 3);
                }
                allFreeGifts.forEach(gift => {
                    if (!giftsToShow.includes(gift)) {
                        gift.checked = false;
                    }
                });
                renderItems('free-gifts-container', giftsToShow);

                updateTotals();
            }

            // 處理地址選擇
            const citySelect = document.getElementById('city');
            const districtSelect = document.getElementById('district');

            function populateCities() {
                for (const city in taiwanDistricts) {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                }
            }

            function populateDistricts() {
                districtSelect.innerHTML = '<option value="">請選擇區</option>';
                const selectedCity = citySelect.value;
                if (selectedCity && taiwanDistricts[selectedCity]) {
                    taiwanDistricts[selectedCity].forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                }
            }

            citySelect.addEventListener('change', populateDistricts);

            // 重置功能
            resetButton.addEventListener('click', () => {
                mainToothbrushes.forEach(item => item.quantity = 0);
                allFreeGifts.forEach(item => item.checked = false);
                
                document.getElementById('name').value = '';
                document.getElementById('gender').value = '小姐';
                document.getElementById('clinic-name').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('sales-rep-name').value = '';
                document.getElementById('city').value = '';
                populateDistricts();
                document.getElementById('address-detail').value = '';
                
                updateDisplay();
                showMessage('所有資訊已重置。');
            });
            
            // 提交功能
            submitButton.addEventListener('click', () => {
                const name = document.getElementById('name').value;
                const clinicName = document.getElementById('clinic-name').value;
                const phone = document.getElementById('phone').value;
                const salesRepName = document.getElementById('sales-rep-name').value;
                const city = document.getElementById('city').value;
                const district = document.getElementById('district').value;
                const addressDetail = document.getElementById('address-detail').value;

                if (!name || !clinicName || !phone || !salesRepName || !city || !district || !addressDetail) {
                    showMessage('請完整填寫聯繫資訊後再提交。');
                    return;
                }

                const orderDetails = generateOrderDetails();
                orderDetailsDisplay.textContent = orderDetails;
                orderModal.classList.remove('hidden');
            });

            // 生成訂單內容
            function generateOrderDetails() {
                const name = document.getElementById('name').value;
                const gender = document.getElementById('gender').value;
                const clinicName = document.getElementById('clinic-name').value;
                const phone = document.getElementById('phone').value;
                const salesRepName = document.getElementById('sales-rep-name').value;
                const city = document.getElementById('city').value;
                const district = document.getElementById('district').value;
                const addressDetail = document.getElementById('address-detail').value;

                let orderContent = 
`因功能限制，要請您幫忙手動發送此資料到jowong@tescodental.com和ciafung@tescodental.com的郵箱，在確認訂單時，會再回覆此郵件通知您，感謝您的購買與對TePe的支持！如有任何想備註的內容請寫在此處：

--- 聯繫資訊 ---
姓名: ${name} (${gender})
業務名稱: ${salesRepName}
診所名稱: ${clinicName}
聯絡電話: ${phone}
診所地址: ${city}${district}${addressDetail}

--- 訂購清單 ---
`;
                
                mainToothbrushes.forEach(item => {
                    if (item.quantity > 0) {
                        orderContent += `主要牙刷 - ${item.name}: ${item.quantity} 個\n`;
                    }
                });
                
                allFreeGifts.forEach(item => {
                    if (item.checked) {
                        orderContent += `免費贈品 - ${item.name}: 1 份\n`;
                    }
                });

                orderContent += `
--- 訂單總計 ---
旅行組總價: ${mainTotalEl.textContent}
旅行組折後總價: ${discountedTotalEl.textContent}
共省下: ${totalSavingsEl.textContent}
訂單總金額: ${grandTotalEl.textContent}
`;

                return orderContent;
            }

            // 複製訂單內容到剪貼簿
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(orderDetailsDisplay.textContent).then(() => {
                    showMessage('訂單內容已複製到剪貼簿！');
                }).catch(err => {
                    console.error('無法複製:', err);
                    showMessage('無法複製內容，請手動選取複製。');
                });
            });

// 發送郵件
sendMailBtn.addEventListener('click', () => {
    const subject = `TePe 旅行組訂購 - ${document.getElementById('clinic-name').value}`;
    const body = generateOrderDetails();
    const to = 'jowong@tescodental.com,ciafung@tescodental.com';

    // 直接建立 Gmail 的撰寫郵件 URL，此方法更可靠且支援較長內文
    const gmailLink = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(to)}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    try {
        // 在新分頁中開啟 Gmail 連結
        window.open(gmailLink, '_blank');
        orderModal.classList.add('hidden');
    } catch (error) {
        console.error('Failed to open Gmail compose window:', error);
        showMessage('無法自動開啟 Gmail。請手動複製內容並發送。');
    }
});

            closeOrderModalBtn.addEventListener('click', () => {
                orderModal.classList.add('hidden');
            });

            populateCities();
            updateDisplay();
        });
    </script>
</body>
</html>

